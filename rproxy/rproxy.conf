LimitRequestLine 32760
LimitRequestFieldSize 32760

<VirtualHost *:80>
    RewriteEngine on
    ProxyPreserveHost On
    ProxyRequests off

    DocumentRoot /var/www/9x9/corp

    <Directory />
        Options FollowSymLinks
        AllowOverride None
    </Directory>

    <Directory /var/www/9x9/corp/>
        Options FollowSymLinks
        AllowOverride None
        Order allow,deny
        allow from all
    </Directory>

    <Directory /var/www/9x9/cms/>
        Options FollowSymLinks
        AllowOverride None
        Order allow,deny
        allow from all
    </Directory>


    <Directory /var/www/9x9/chromecast/>
        Options FollowSymLinks
        AllowOverride None
        Order allow,deny
        allow from all
    </Directory>

    <Directory /var/www/9x9/cast/>
        Options FollowSymLinks
        AllowOverride None
        Order allow,deny
        allow from all
    </Directory>

    <Directory /var/www/9x9/9x9_player50/dist/>
        Options FollowSymLinks
        DirectoryIndex index.html
        AllowOverride None
        Order allow,deny
        allow from all
    </Directory>

    <Directory /var/www/9x9/9x9_receiver/debug/>
        Options FollowSymLinks
        DirectoryIndex index.html
        AllowOverride None
        Order allow,deny
        allow from all
    </Directory>

    Alias /cms /var/www/9x9/cms
    Alias /cast /var/www/9x9/cast
    Alias /mobile  /var/www/9x9/9x9_player50/dist

    # enabled mod_geoip in /etc/apache2/mods-available/geoip.conf
    #GeoIPEnable On
    #GeoIPDBFile /usr/share/GeoIP/GeoIP.dat MemoryCache
    #GeoIPScanProxyHeaders On

    # 1-ft with v32.9x9.tv
    RewriteCond %{HTTP_HOST} ^v32.9x9.tv$ [NC]
    RewriteRule ^/(.*)$ http://localhost:8080/$1 [L,QSA,P]

    # click player on android page goto 10-ft
    RewriteCond %{HTTP_REFERER} ^http://www\.9x9\.tv/android/ [NC]
    RewriteRule ^/$ /tv/ [L,R=301]

    RewriteCond %{HTTP_REFERER} ^http://www\.9x9\.tv/android/ [NC]
    RewriteRule ^/android/$ /tv/ [L,R=301]

    # for android page
    RewriteRule ^/(android.*)$ http://localhost:8080/$1 [L,QSA,P]

    # partner url
    #RewriteRule ^/(tvhs.*) http://player.9x9.tv/$1 [L,NE,QSA]
	
    # Chromecast 
    #RewriteRule ^/(cast/*)$ http://localhost:8080/tv [L,QSA,P]

    # paths for jetty
    RewriteRule ^/(playerAPI/.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(podcastAPI/.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(api/.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(tv/.*)$ http://localhost:8080/$1 [L,QSA,P]

    # for chromecast device
    # "Mozilla/5.0 (CrKey armv7l 1.2.13300) AppleWebKit/537.31 (KHTML, like Gecko) Chrome/26.0.1410.0 Safari/537.31"
    RewriteCond %{HTTP_USER_AGENT} "CrKey" [NC]
    RewriteRule ^/(tv)$ http://www.9x9.tv/cast/tom.html [L,R=302]

    RewriteRule ^/(tv)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(playback.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(player/.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(stylesheets/.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(9x9/.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(wd/.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(pdr/.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(share/.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(version/.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(admin/.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(content_worker/.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(fb/.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(hello/.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(thumbnail/.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(images/.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(apple-touch-icon.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(support.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(tanks.*)$ http://localhost:8080/$1 [L,QSA,P]

    # for redirect
    RewriteRule ^/(redirect/.*)$ http://localhost:8080/$1 [L,QSA,P]

    # let cts.9x9.tv use it's favicon
    RewriteCond %{HTTP_HOST} ^cts.9x9.tv$ [NC]
    RewriteRule ^/favicon.ico http://s3-us-west-2.amazonaws.com/9x9test/cts_2.ico [L,QSA,R=301]

    # let goodtv.9x9.tv use it's favicon
    RewriteCond %{HTTP_HOST} ^goodtv.9x9.tv$ [NC]
    RewriteRule ^/favicon.ico http://s3-us-west-2.amazonaws.com/9x9test/goodtv.ico [L,QSA,R=301]

    # no favicon in new corp site so I use it from jetty
    RewriteRule ^/favicon.ico http://localhost:8080/favicon.ico [L,QSA,P]

    # 1-ft with player.9x9.tv
    RewriteCond %{HTTP_HOST} ^player.9x9.tv$ [NC]
    RewriteRule ^/(.*)$ http://localhost:8080/tv40/$1 [L,QSA,P]

    # corp site
    RewriteRule ^/chromecast.* - [L,QSA] # Added by Caspar for test chromecast
    RewriteRule ^/tv40/(.*) http://dev6.9x9.tv/tv640/$1 [L,R=301] # Redirct to dev6 for RD test
    RewriteRule ^/tv40$ /tv40/ [L,R=301] #  Redirct to dev6 for RD test
    RewriteRule ^/cast/.* - [L,QSA]
    RewriteRule ^/cast$ /cast/ [L,R=301]
    RewriteRule ^/en/.* - [L,QSA]
    RewriteRule ^/en$ /en/ [L,R=301]
    RewriteRule ^/zh/.* - [L,QSA]
    RewriteRule ^/zh$ /zh/ [L,R=301]
    RewriteRule ^/css/.* - [L,QSA]
    RewriteRule ^/img/.* - [L,QSA]
    RewriteRule ^/js/.* - [L,QSA]
    RewriteRule ^/crossdomain\.xml - [L]
    RewriteRule ^/ellipsis\.xml - [L]
    RewriteRule ^/humans\.txt - [L]
    RewriteRule ^/robots\.txt - [L]
    RewriteRule ^/cms/.* - [L,QSA]
    RewriteRule ^/mobile/.* - [L,QSA]

    
    # iOS devices no redirect for view and flview
    RewriteRule ^/(view.*)$ http://localhost:8080/$1 [L,QSA,P]
    RewriteRule ^/(flview.*)$ http://localhost:8080/$1 [L,QSA,P]

    # fb share urls go to 10-ft playback page
    RewriteRule ^/flview(.*)$ /playback$1 [L,QSA,R=301]

    # cts.9x9.tv
    RewriteCond %{HTTP_HOST} ^cts.9x9.tv$ [NC]
    RewriteRule ^/(.*)$ http://localhost:8080/tv/$1 [L,QSA,P]

    # ddtv.9x9.tv
    RewriteCond %{HTTP_HOST} ^ddtv.9x9.tv$ [NC]
    RewriteRule ^/(.*)$ http://localhost:8080/tv/$1 [L,QSA,P]

    # goodtv.9x9.tv
    RewriteCond %{HTTP_HOST} ^goodtv.9x9.tv$ [NC]
    RewriteRule ^/(.*)$ http://localhost:8080/tv/$1 [L,QSA,P]

    # tzuchi40.9x9.tv
    RewriteCond %{HTTP_HOST} ^tzuchi40.9x9.tv$ [NC]
    RewriteRule ^/(.*)$ http://localhost:8080/tv40/$1 [L,QSA,P]

    # fcu.9x9.tv
    RewriteCond %{HTTP_HOST} ^fcu.9x9.tv$ [NC]
    RewriteRule ^/(.*)$ http://localhost:8080/tv/$1 [L,QSA,P]

    # qrcode mobile installer redirect
    RewriteCond %{HTTP_USER_AGENT} ^.*(iPad|iPhone|iPod).*$ [NC]
    RewriteRule ^/qrcode/ddtvapp https://itunes.apple.com/us/app/ding-ding-dian-shi/id733144372 [L,R=302]
    RewriteCond %{HTTP_USER_AGENT} "android" [NC]
    RewriteRule ^/qrcode/ddtvapp https://play.google.com/store/apps/details?id=tv.ddtv.player9x9tv [L,R=302]
    RewriteRule ^/qrcode/ddtvapp http://ddtv.9x9.tv/ [L,R=302]

    RewriteCond %{HTTP_USER_AGENT} ^.*(iPad|iPhone|iPod).*$ [NC]
    RewriteRule ^/qrcode/9x9tvapp https://itunes.apple.com/us/app/9x9.tv/id443352510 [L,R=302]
    RewriteCond %{HTTP_USER_AGENT} "android" [NC]
    RewriteRule ^/qrcode/9x9tvapp https://play.google.com/store/apps/details?id=tv.tv9x9.player [L,R=302]
    RewriteRule ^/qrcode/9x9tvapp http://www.9x9.tv/tv/ [L,R=302]

    RewriteCond %{HTTP_USER_AGENT} ^.*(iPad|iPhone|iPod).*$ [NC]
    RewriteRule ^/qrcode/ctsapp https://itunes.apple.com/us/app/wei-dian-ying-jie-hua-shi/id623085456 [L,R=302]
    RewriteCond %{HTTP_USER_AGENT} "android" [NC]
    RewriteRule ^/qrcode/ctsapp https://play.google.com/store/apps/details?id=tw.com.cts.player [L,R=302]
    RewriteRule ^/qrcode/ctsapp http://cts.9x9.tv/ [L,R=302]

    RewriteCond %{HTTP_USER_AGENT} ^.*(iPad|iPhone|iPod).*$ [NC]
    RewriteRule ^/qrcode/fcuapp https://itunes.apple.com/us/app/feng-jia-ying-yin/id723980669 [L,R=302]
    RewriteCond %{HTTP_USER_AGENT} "android" [NC]
    RewriteRule ^/qrcode/fcuapp https://play.google.com/store/apps/details?id=tv.tv9x9.player [L,R=302]
    RewriteRule ^/qrcode/fcuapp http://fcu.9x9.tv/ [L,R=302]

    RewriteCond %{HTTP_USER_AGENT} ^.*(iPad|iPhone|iPod).*$ [NC]
    RewriteRule ^/qrcode/goodtvapp https://itunes.apple.com/us/app/good-tv-flipr/id737001290 [L,R=302]
    RewriteCond %{HTTP_USER_AGENT} "android" [NC]
    RewriteRule ^/qrcode/goodtvapp https://play.google.com/store/apps/details?id=tv.goodtv.player9x9tv [L,R=302]
    RewriteRule ^/qrcode/goodtvapp http://goodtv.9x9.tv/ [L,R=302]

    # for TW IP go to new corp zh site
    RewriteCond %{ENV:GEOIP_COUNTRY_CODE} ^TW$
    RewriteRule ^/.*$ /zh/ [L,DPI,R=301]

    # all others default to en site
    RewriteRule ^/.*$ /en/ [L,DPI,R=301]

    ErrorLog /var/log/apache2/rproxy-error.log
    CustomLog "|/usr/bin/tee -a /var/log/apache2/rproxy-access.log | /usr/bin/logger -thttpd -plocal6.notice" combined
</VirtualHost>

